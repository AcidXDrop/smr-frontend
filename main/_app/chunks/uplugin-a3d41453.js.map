{"version":3,"file":"uplugin-a3d41453.js","sources":["../../../../../src/lib/utils/uplugin.ts"],"sourcesContent":["import { Validator } from '@cfworker/json-schema';\nimport { API_BASE } from '$lib/core';\n\nlet resolver;\nconst uPluginValidator = new Promise<Validator>((r) => (resolver = r));\n\nfetch(API_BASE + '/static/uplugin-json-schema.json')\n  .then((response) => response.json())\n  .then((json) => resolver(new Validator(json)));\n\nexport const validateUPluginJson = async (input: string): Promise<string[]> => {\n  const validator = await uPluginValidator;\n\n  try {\n    const objInput = JSON.parse(input);\n    const result = validator.validate(objInput);\n\n    if (result.valid) {\n      return [];\n    }\n\n    return result.errors\n      .map((error) => {\n        if (error.keyword === '$ref') {\n          return undefined;\n        }\n\n        let message = '`' + error.instanceLocation + '`';\n\n        const value = resolveValue(objInput, error.instanceLocation);\n\n        if (typeof value !== 'object') {\n          message += ' **\"' + value + '\"**';\n        }\n\n        message += ': ' + error.error;\n\n        return message;\n      })\n      .filter((v) => !!v);\n  } catch (e) {\n    return ['Invalid JSON'];\n  }\n};\n\nconst resolveValue = (object: unknown, path: string) => {\n  const parser = new RegExp(`\\\\['?(.+?)'?\\\\]|\\\\.([^\\\\.\\\\[\\\\]]+)`, `gm`);\n\n  try {\n    let value = object;\n    let key = parser.exec(path);\n    while (key !== null) {\n      value = value[key[1] || key[2]];\n      key = parser.exec(path);\n    }\n    return value;\n  } catch (e) {\n    // Ignore exception\n  }\n\n  return undefined;\n};\n"],"names":["resolver","uPluginValidator","Promise","r","fetch","API_BASE","then","response","json","Validator","validateUPluginJson","async","input","validator","objInput","JSON","parse","result","validate","valid","errors","map","error","keyword","message","instanceLocation","value","resolveValue","filter","v","e","object","path","parser","RegExp","key","exec"],"mappings":"2GAGA,IAAIA,EACJ,MAAMC,EAAmB,IAAIC,SAAoBC,GAAOH,EAAWG,IAEnEC,MAAMC,EAAW,oCACdC,MAAMC,GAAaA,EAASC,SAC5BF,MAAME,GAASR,EAAS,IAAIS,EAAUD,YAE5BE,EAAsBC,MAAOC,UAClCC,QAAkBZ,YAGhBa,EAAWC,KAAKC,MAAMJ,GACtBK,EAASJ,EAAUK,SAASJ,UAE9BG,EAAOE,MACF,GAGFF,EAAOG,OACXC,KAAKC,OACkB,SAAlBA,EAAMC,mBAINC,EAAU,IAAMF,EAAMG,iBAAmB,UAEvCC,EAAQC,EAAab,EAAUQ,EAAMG,wBAEtB,iBAAVC,OACE,OAASA,EAAQ,UAGnB,KAAOJ,EAAMA,MAEjBE,KAERI,QAAQC,KAAQA,UACZC,SACA,CAAC,kBAINH,EAAe,CAACI,EAAiBC,WAC/BC,EAAS,IAAIC,OAAO,qCAAsC,cAG1DR,EAAQK,EACRI,EAAMF,EAAOG,KAAKJ,QACP,OAARG,KACGT,EAAMS,EAAI,IAAMA,EAAI,MACtBF,EAAOG,KAAKJ,UAEbN,QACAI"}