{"version":3,"file":"edit.svelte-f4340ddf.js","sources":["../../../../../../../../../src/routes/mod/[modId]/version/[versionId]/edit.svelte"],"sourcesContent":["<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors \n      description=\"Editing mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Edit mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" \n    />\n  {/if}\n</svelte:head>\n\n<script lang=\"ts\" context=\"module\">\n  import {paramsToProps} from \"$lib/utils/routing\";\n\n  export const load = paramsToProps();\n</script>\n\n<script lang=\"ts\">\n  import {mutation, operationStore, query} from '@urql/svelte';\n  import {GetModVersionDocument, UpdateVersionDocument} from \"$lib/generated\";\n  import Toast from \"$lib/components/general/Toast.svelte\";\n  import {goto} from '$app/navigation';\n  import VersionForm from \"$lib/components/versions/VersionForm.svelte\";\n  import type {VersionData} from \"$lib/models/versions\";\n  import {base} from \"$app/paths\";\n  import MetaDescriptors from \"$lib/components/utils/MetaDescriptors.svelte\";\n\n\n  export let modId!: string;\n  export let versionId!: string;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const version = operationStore(\n    GetModVersionDocument,\n    {version: versionId}\n  );\n\n  const editVersion = mutation({\n    query: UpdateVersionDocument\n  });\n\n  const onSubmit = async (data: VersionData) => {\n    return editVersion({\n      versionId: versionId,\n      version: data\n    }).then(value => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error editing version: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        return goto(base + '/mod/' + modId + '/version/' + versionId);\n      }\n    });\n  }\n\n  $: if (!errorToast) errorMessage = '';\n\n  $: initialValues = $version.data ? {\n    ...$version.data.getVersion,\n    logo: undefined\n  } : undefined;\n\n  query(version);\n</script>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Version</h1>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else}\n  <VersionForm onSubmit={onSubmit} initialValues={initialValues} editing={true} submitText=\"Save\"/>\n{/if}\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["ctx","data","getVersion","mod","name","version","ctx2","error","message","fetching","load","paramsToProps","__awaiter","this","thisArg","_arguments","P","generator","modId","versionId","errorMessage","errorToast","operationStore","GetModVersionDocument","editVersion","mutation","query","UpdateVersionDocument","initialValues","$version","Object","assign","logo","then","value","goto","base"],"mappings":"+nCAGwCA,KAASC,KAAKC,WAAWC,IAAIC,SAAOJ,KAASC,KAAKC,WAAWG,kCACtEL,KAASC,KAAKC,WAAWC,IAAIC,SAAOJ,KAASC,KAAKC,WAAWG,8IADpDC,KAASL,KAAKC,WAAWC,IAAIC,SAAOE,KAASL,KAAKC,WAAWG,2CACtEC,KAASL,KAAKC,WAAWC,IAAIC,SAAOE,KAASL,KAAKC,WAAWG,yJAsEnEL,mBAAyBA,cAAwB,qIAAxBM,0HAFnCN,KAASO,MAAMC,mCAAzB,yDAAA,sFAAUF,KAASC,MAAMC,0FAFzB,mDAAA,gIAQIR,8CAAAA,4DAAAM,iEA7EDN,KAASS,WAAaT,KAASO,OAASP,KAASC,KAAKC,6DAoEzDI,KAASG,WAEJH,KAASC,oHAMEP,iBAAAA,gGAVe,uMAAA,+PAlE5BM,KAASG,UAAaH,KAASC,QAASD,KAASL,KAAKC,wUA4EzCI,iMAjENI,EAAOC,kCAGLC,EAAAC,MAAAA,KAAAD,oBAAAE,EAAAC,EAAAC,EAAAC,+RAWJC,gBACAC,KAEPC,EAAe,GACfC,GAAa,QAEXhB,EAAUiB,EACdC,GACClB,QAASc,+BAGNK,EAAcC,GAClBC,MAAOC,aA0BHtB,gHAPEgB,OAAYD,EAAe,uBAEhCQ,EAAgBC,EAAS5B,KAAM6B,OAAAC,OAAAD,OAAAC,UAC7BF,EAAS5B,KAAKC,aACjB8B,UAAM,SACJ,kBArByCpB,2CACpCY,GACML,UAAAA,EACXd,QAASJ,IACRgC,cACGC,EAAM3B,aAMD4B,EAAKC,EAAO,QAAUlB,EAAQ,YAAcC,WAL3CZ,MAAM2B,EAAM3B,MAAMC,aAC1BY,EAAe,0BAA4Bc,EAAM3B,MAAMC,aACvDa,GAAa"}