{"version":3,"file":"edit.svelte-0268212b.js","sources":["../../../../../../../../../src/routes/mod/[modId]/version/[versionId]/edit.svelte"],"sourcesContent":["<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n\n  export const load = paramsToProps();\n</script>\n\n<script lang=\"ts\">\n  import { mutation, operationStore, query } from '@urql/svelte';\n  import { GetModVersionDocument, UpdateVersionDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import VersionForm from '$lib/components/versions/VersionForm.svelte';\n  import type { VersionData } from '$lib/models/versions';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n\n  export let modId!: string;\n  export let versionId!: string;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const version = operationStore(GetModVersionDocument, { version: versionId });\n\n  const editVersion = mutation({\n    query: UpdateVersionDocument\n  });\n\n  const onSubmit = async (data: VersionData) => {\n    return editVersion({\n      versionId: versionId,\n      version: data\n    }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error editing version: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        return goto(base + '/mod/' + modId + '/version/' + versionId);\n      }\n    });\n  };\n\n  $: if (!errorToast) errorMessage = '';\n\n  $: initialValues = $version.data\n    ? {\n        ...$version.data.getVersion,\n        logo: undefined\n      }\n    : undefined;\n\n  query(version);\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Editing mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Edit mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n    />\n  {/if}\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit Version</h1>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else}\n  <VersionForm\n    {onSubmit}\n    {initialValues}\n    modReference={$version.data.getVersion.mod.mod_reference}\n    editing={true}\n    submitText=\"Save\"\n  />\n{/if}\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":[],"mappings":"+oCA2DwC,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,kCACtE,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,8IADpD,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,2CACtE,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,gMAe1E,KAAS,KAAK,WAAW,IAAI,sBAClC,iKADK,KAAS,KAAK,WAAW,IAAI,kIALhC,KAAS,MAAM,qCAAzB,yDAAA,2CAAH,2CAAa,KAAS,MAAM,2FAFzB,mDAAA,mCAAH,8FAcO,8CAAA,2BAAP,iCAAO,kEAzBD,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,+DAUzD,MAAS,WAEJ,KAAS,2GAYE,2BAAA,+FAhBe,wMAAA,yLAApC,uEARQ,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,oUAwBzC,8LA9ErB,IAAA,iCAaA,YACA,eAEA,EAAA,GACA,EAAA,QAEA,GAAA,EAAA,IAAA,QAAA,4BAEA,GAAA,IACA,MAAA,KAGA,OAAA,IACA,GACA,YACA,QAAA,IACA,KAAA,OACA,EAAA,MACA,QAAA,MAAA,EAAA,MAAA,aACA,EAAA,0BAAA,EAAA,MAAA,aACA,EAAA,eAGA,IAAA,GAAA,QAAA,EAAA,YAAA,KAcA,GAAA,iBA4BqB,8HArCrB,QAAA,EAAA,uBAEA,EAAA,EAAA,SAEA,EAAA,KAAA,WACA,KAAA,QAEA"}