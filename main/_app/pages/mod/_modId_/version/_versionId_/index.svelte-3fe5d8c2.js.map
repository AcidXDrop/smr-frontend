{"version":3,"file":"index.svelte-3fe5d8c2.js","sources":["../../../../../../../../../src/lib/components/versions/VersionDescription.svelte","../../../../../../../../../src/lib/components/versions/VersionInfo.svelte","../../../../../../../../../src/routes/mod/[modId]/version/[versionId]/index.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { markdown } from '$lib/utils/markdown';\n\n  export let changelog!: string;\n</script>\n\n<div class=\"markdown-content\">\n  {#await markdown(changelog) then changelogRendered}\n    <p>{@html changelogRendered}</p>\n  {/await}\n</div>\n","<script lang=\"ts\">\n  import type { Version } from '$lib/generated';\n\n  export let version!: Pick<Version, 'created_at' | 'sml_version' | 'size' | 'stability' | 'downloads' | 'hash'>;\n</script>\n\n<div class=\"text-lg\">\n  <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n  <!-- TODO Nice Date -->\n  <span><strong>Created:</strong> {version.created_at}</span><br />\n  <span><strong>Downloads:</strong> {version.downloads}</span><br />\n  <span><strong>SML Version:</strong> {version.sml_version}</span><br />\n  <span><strong>Stability:</strong> {version.stability}</span><br />\n  <!-- TODO Pretty Bytes -->\n  <span><strong>Size:</strong> {version.size}</span><br />\n  <span><strong>Hash:</strong> {version.hash}</span>\n</div>\n","<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n  import { operationStore } from '@urql/svelte';\n  import { GetModVersionDocument } from '$lib/generated';\n  import { loadWaitForNoFetch } from '$lib/utils/gql';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n\n  const versionQ = operationStore(GetModVersionDocument, { version: undefined });\n\n  export const load = paramsToProps(async (input) => {\n    versionQ.variables.version = input.page.params.versionId;\n    return loadWaitForNoFetch({\n      version: versionQ\n    })(input);\n  });\n</script>\n\n<script lang=\"ts\">\n  import { mutation, query } from '@urql/svelte';\n  import { DeleteVersionDocument } from '$lib/generated';\n  import VersionDescription from '$lib/components/versions/VersionDescription.svelte';\n  import VersionInfo from '$lib/components/versions/VersionInfo.svelte';\n  import Icon from '@iconify/svelte';\n  import downloadIcon from '@iconify/icons-mdi/download.js';\n  import { API_REST } from '$lib/core';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import Dialog from '$lib/components/general/Dialog.svelte';\n  import { writable } from 'svelte/store';\n  import { goto } from '$app/navigation';\n  import { user } from '$lib/stores/user';\n  import { base } from '$app/paths';\n  import { browser } from '$app/env';\n\n  export let modId!: string;\n  export let versionId!: string;\n  export let version: typeof versionQ;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const deleteVersion = mutation({\n    query: DeleteVersionDocument\n  });\n\n  $: canUserEdit =\n    $user?.roles?.deleteContent ||\n    $version?.data?.getVersion.mod?.authors?.findIndex((author) => author.user_id == $user?.id) >= 0;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteVersionFn = () => {\n    deleteVersion({ versionId }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error deleting version: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        goto(base + '/mod/' + modId);\n      }\n    });\n  };\n\n  if (browser) {\n    query(version);\n  }\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Information for mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n    />\n  {/if}\n</svelte:head>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else if $version.data.getVersion}\n  <div class=\"grid gap-8 grid-auto-max\">\n    <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n      <div class=\"grid grid-flow-col grid-auto-max h-auto items-center\">\n        <h1 class=\"text-4xl my-4 font-bold\">\n          {$version.data.getVersion.mod.name}\n          Version {$version.data.getVersion.version}\n        </h1>\n\n        <div class=\"grid grid-flow-col gap-4\">\n          {#if canUserEdit}\n            <button\n              class=\"py-2 px-4 rounded text-base bg-yellow-600\"\n              on:click={() => goto(base + '/mod/' + modId + '/version/' + versionId + '/edit')}\n            >\n              Edit\n            </button>\n            <button class=\"py-2 px-4 rounded text-base bg-red-500\" on:click={() => deleteDialogOpen.set(true)}>\n              Delete\n            </button>\n          {/if}\n\n          <a\n            href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/download'}\n            class=\"py-2 px-4 rounded text-base bg-green-600 text-center\">Download</a\n          >\n          <!-- TODO SMM -->\n          <a href={base} class=\"py-2 px-4 rounded text-base bg-blue-600 text-center\">\n            <span>Install</span>\n            <Icon icon={downloadIcon} inline={true} class=\"inline-block\" />\n          </a>\n        </div>\n      </div>\n      <VersionDescription changelog={$version.data.getVersion.changelog} />\n    </div>\n    <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n      <VersionInfo version={$version.data.getVersion} />\n    </div>\n  </div>\n\n  <Dialog bind:open={$deleteDialogOpen}>\n    <div class=\"grid grid-flow-row gap-4\">\n      <h3 class=\"text-2xl font-bold\">Delete Version?</h3>\n\n      <span>Are you sure you wish to delete this version</span>\n\n      <button class=\"py-1 px-4 rounded text-base bg-yellow-600\" on:click={() => deleteDialogOpen.set(false)}>\n        Cancel\n      </button>\n      <button class=\"py-1 px-4 rounded text-base bg-red-500\" on:click={() => deleteVersionFn()}> Delete </button>\n    </div>\n  </Dialog>\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n\n<style lang=\"postcss\">\n  .grid-auto-max {\n    grid-template-columns: auto max-content;\n  }\n</style>\n"],"names":["downloadIcon"],"mappings":"stCAQc,gFAAV,2CAAU,0MADJ,GAAS,uKADnB,kGACU,GAAS,0GAJnB,8LCMmC,KAAQ,8BACN,KAAQ,8BACN,KAAQ,iCACV,KAAQ,iCAEb,KAAQ,4BACR,KAAQ,+CARF,4CAEtB,uEACA,yEACA,6EACA,8EAEA,sEACA,qHARsB,iGAEtB,oJACA,sJACA,0JACA,6JAEA,oJACA,2JAThB,SACE,qBAEA,OAAM,4BAAqD,cAC3D,OAAM,4BAAsD,cAC5D,OAAM,6BAA0D,eAChE,OAAM,6BAAsD,gBAE5D,QAAM,iCAA4C,cAClD,OAAM,uDAN2B,KAAQ,oCACN,KAAQ,mCACN,KAAQ,qCACV,KAAQ,mCAEb,KAAQ,gCACR,KAAQ,mEAZxC,2OCoEgD,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,6BACnF,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,yJADvC,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,sCACnF,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,yIAkE9D,mBAAA,iFApDd,KAAS,KAAK,WAAW,IAAI,cACrB,KAAS,KAAK,WAAW,kEAI7B,kCAmBSA,UAAsB,sDAIT,KAAS,KAAK,WAAW,sCAGlC,KAAS,KAAK,sFAIrB,wBAAA,sIAaE,4BAAA,sHAhDqB;AAAA,yEAmB6B,2CAIvD,yTAvB0B;AAAA,qJAmB6B,+GAIvD,2VALA,GAAW,QAAU,KAAQ,aAAe,KAAY,4FAIvD,yWA1BjB,SACE,OACE,OACE,mCAKA,6BAaE,qBAKA,OACE,8DAOR,0FA9BO,KAAS,KAAK,WAAW,IAAI,oCACrB,KAAS,KAAK,WAAW,qBAI7B,6EAaG,GAAW,QAAU,KAAQ,aAAe,KAAY,0DAUrC,KAAS,KAAK,WAAW,gDAGlC,KAAS,KAAK,+FAIrB,0GAaE,iWAtDR,KAAS,MAAM,qCAAzB,yDAAA,2CAAH,2CAAa,KAAS,MAAM,4FAFzB,mDAAA,mCAAH,0GAiBU,gCAGkG,qEAHlG,wEAGkG,4JANlG,yBAMA,wMAyByB,yCAEzB,wEAEgG,kCAGZ,oGAP3D,yEAEzB,gHAEgG,0EAGZ,mPAR5F,SACE,qBAEA,qBAEA,qBAGA,qJAKK,8CAAA,2BAAP,mCAAO,wDAlEH,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,mEAQzD,MAAS,WAEJ,KAAS,QAET,KAAS,KAAK,4SAZhB,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,0WA9D9D,IAAA,GAAA,IAAA,QAAA,SAEA,GAAA,QAAA,IACA,IAAA,UAAA,QAAA,EAAA,KAAA,OAAA,UACA,IACA,QAAA,KACA,kIAoBA,YACA,gBACA,oBAEA,GAAA,GACA,EAAA,QAEA,GAAA,IACA,MAAA,KAOA,EAAA,GAAA,6BAEA,QACA,GAAA,cAAA,KAAA,IACA,EAAA,MACA,SAAA,MAAA,EAAA,MAAA,aACA,EAAA,2BAAA,EAAA,MAAA,aACA,EAAA,KAGA,GAAA,GAAA,QAAA,MAMA,GAAA,eA8B8B,GAAK,GAAO,QAAU,EAAQ,YAAc,EAAY,eAIH,EAAiB,IAAI,UA6BxB,EAAiB,IAAI,UAGxB,kBATxD,2BAaE,wKA1FvB,EACA,GAAA,OAAA,eACA,GAAA,MAAA,WAAA,KAAA,SAAA,UAAA,GAAA,EAAA,SAAA,GAAA,KAAA"}