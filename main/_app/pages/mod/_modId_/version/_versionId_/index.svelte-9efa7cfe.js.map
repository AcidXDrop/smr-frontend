{"version":3,"file":"index.svelte-9efa7cfe.js","sources":["../../../../../../../../../src/lib/components/versions/VersionDescription.svelte","../../../../../../../../../src/lib/components/versions/VersionInfo.svelte","../../../../../../../../../src/routes/mod/[modId]/version/[versionId]/index.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { markdown } from '$lib/utils/markdown';\n  import Card, { Content } from '@smui/card';\n\n  export let changelog!: string;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"markdown-content\">\n      {#await markdown(changelog) then changelogRendered}\n        <p>{@html changelogRendered}</p>\n      {/await}\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import type { Version } from '$lib/generated';\n  import Card, { Content } from '@smui/card';\n\n  export let version!: Pick<Version, 'created_at' | 'sml_version' | 'size' | 'stability' | 'downloads' | 'hash'>;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"text-lg\">\n      <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n      <!-- TODO Nice Date -->\n      <span><strong>Created:</strong> {version.created_at}</span><br />\n      <span><strong>Downloads:</strong> {version.downloads}</span><br />\n      <span><strong>SML Version:</strong> {version.sml_version}</span><br />\n      <span><strong>Stability:</strong> {version.stability}</span><br />\n      <!-- TODO Pretty Bytes -->\n      <span><strong>Size:</strong> {version.size}</span><br />\n      <span><strong>Hash:</strong> {version.hash}</span>\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n  import { operationStore } from '@urql/svelte';\n  import { GetModVersionDocument } from '$lib/generated';\n  import { loadWaitForNoFetch } from '$lib/utils/gql';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n\n  const versionQ = operationStore(GetModVersionDocument, { version: undefined });\n\n  export const load = paramsToProps(async (input) => {\n    versionQ.variables.version = input.page.params.versionId;\n    return loadWaitForNoFetch({\n      version: versionQ\n    })(input);\n  });\n</script>\n\n<script lang=\"ts\">\n  import { mutation, query } from '@urql/svelte';\n  import { DeleteVersionDocument } from '$lib/generated';\n  import VersionDescription from '$lib/components/versions/VersionDescription.svelte';\n  import VersionInfo from '$lib/components/versions/VersionInfo.svelte';\n  import { API_REST } from '$lib/core';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { writable } from 'svelte/store';\n  import { goto } from '$app/navigation';\n  import { user } from '$lib/stores/user';\n  import { base } from '$app/paths';\n  import { browser } from '$app/env';\n  import Button, { Label, Icon } from '@smui/button';\n  import Dialog, { Title, Content as DialogContent } from '@smui/dialog';\n\n  export let modId!: string;\n  export let versionId!: string;\n  export let version: typeof versionQ;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const deleteVersion = mutation({\n    query: DeleteVersionDocument\n  });\n\n  $: canUserEdit =\n    $user?.roles?.deleteContent ||\n    $version?.data?.getVersion.mod?.authors?.findIndex((author) => author.user_id == $user?.id) >= 0;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteVersionFn = () => {\n    deleteVersion({ versionId }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error deleting version: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        goto(base + '/mod/' + modId);\n      }\n    });\n  };\n\n  if (browser) {\n    query(version);\n  }\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Information for mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n    />\n  {/if}\n</svelte:head>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else if $version.data.getVersion}\n  <div class=\"grid gap-8 grid-auto-max xlx:grid-flow-row\">\n    <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n      <div class=\"flex flex-wrap h-auto justify-between\">\n        <h1 class=\"text-4xl my-4 font-bold\">\n          {$version.data.getVersion.mod.name}\n          Version {$version.data.getVersion.version}\n        </h1>\n\n        <div class=\"grid grid-flow-col gap-4\">\n          {#if canUserEdit}\n            <Button\n              variant=\"outlined\"\n              on:click={() => goto(base + '/mod/' + modId + '/version/' + versionId + '/edit')}\n            >\n              Edit\n            </Button>\n            <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(true)}>Delete</Button>\n          {/if}\n\n          <Button variant=\"outlined\" href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/download'}>\n            Download\n          </Button>\n          <!-- TODO SMM -->\n          <Button variant=\"outlined\" href={base}>\n            <Label>Install</Label>\n            <Icon class=\"material-icons\">download</Icon>\n          </Button>\n\n          <Button variant=\"outlined\" href={base + '/mod/' + modId}>\n            <Label>Mod</Label>\n            <Icon class=\"material-icons\">extension</Icon>\n          </Button>\n        </div>\n      </div>\n      <VersionDescription changelog={$version.data.getVersion.changelog} />\n    </div>\n    <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n      <VersionInfo version={$version.data.getVersion} />\n    </div>\n  </div>\n\n  <Dialog bind:open={$deleteDialogOpen}>\n    <Title id=\"simple-title\">Delete Version?</Title>\n    <DialogContent>\n      <div class=\"grid grid-flow-row gap-4\">\n        <span>Are you sure you wish to delete this version</span>\n\n        <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(false)}>Cancel</Button>\n        <Button variant=\"outlined\" on:click={() => deleteVersionFn()}>Delete</Button>\n      </div>\n    </DialogContent>\n  </Dialog>\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n\n<style lang=\"postcss\">\n  @media (min-width: 1279px) {\n    .grid-auto-max {\n      grid-template-columns: auto max-content;\n    }\n  }\n</style>\n"],"names":[],"mappings":"urCAWkB,gFAAV,2CAAU,0MADJ,GAAS,uKADnB,gGACU,GAAS,4rBANvB,8LCQuC,KAAQ,8BACN,KAAQ,+BACN,KAAQ,oCACV,KAAQ,8BAEb,KAAQ,gCACR,KAAQ,+CARF,4CAEtB,uEACA,0EACA,+EACA,4EAEA,0EACA,qHARsB,iGAEtB,oJACA,uJACA,4JACA,yJAEA,yJACA,2JAThB,SACE,qBAEA,OAAM,4BAAqD,cAC3D,OAAM,4BAAsD,eAC5D,OAAM,6BAA0D,eAChE,OAAM,+BAAsD,cAE5D,OAAM,6BAA4C,gBAClD,QAAM,wDAN2B,KAAQ,oCACN,KAAQ,qCACN,KAAQ,yCACV,KAAQ,qCAEb,KAAQ,iCACR,KAAQ,qpBAd5C,2OCkEgD,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,6BACnF,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,sJADvC,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,sCACnF,KAAS,KAAK,WAAW,IAAI,SAAO,KAAS,KAAK,WAAW,uIAmE9D,mBAAA,iFArDd,KAAS,KAAK,WAAW,IAAI,cACrB,KAAS,KAAK,WAAW,2DAI7B,qDAU4B,GAAW,QAAU,KAAQ,aAAe,KAAY,+FAIxD,sFAKA,GAAO,QAAU,0EAMvB,KAAS,KAAK,WAAW,sCAGlC,KAAS,KAAK,sFAIrB,wBAAA,sIAYE,4BAAA,sHAjDqB;AAAA,6YAAA;AAAA,ssBAJ1C,SACE,OACE,OACE,mCAKA,0GA4BJ,uFAhCO,KAAS,KAAK,WAAW,IAAI,oCACrB,KAAS,KAAK,WAAW,qBAI7B,4HAU4B,GAAW,QAAU,KAAQ,aAAe,KAAY,gJASxD,GAAO,QAAU,mFAMvB,KAAS,KAAK,WAAW,gDAGlC,KAAS,KAAK,oGAIrB,+GAYE,wbAvDR,KAAS,MAAM,qCAAzB,yDAAA,2CAAH,2CAAa,KAAS,MAAM,4FAFzB,mDAAA,mCAAH,msBAiBU,oBAAA,6EAGuE,sBAAA,+EAG4B,wBAAA,iFAK5F,uBAAA,gFACsB,wBAAA,2oBAItB,mBAAA,4EACsB,yBAAA,4oBAYZ,+BAAA,wFAKmD,sBAAA,+EACV,sBAAA,2TAHxD,kLAAA,4LADR,SACE,+5BASG,8CAAA,2BAAP,mCAAO,wDAnEH,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,mEAQzD,MAAS,WAEJ,KAAS,QAET,KAAS,KAAK,4SAZhB,KAAS,WAAa,KAAS,OAAS,KAAS,KAAK,sWA7D9D,IAAA,GAAA,IAAA,QAAA,SAEA,GAAA,QAAA,IACA,IAAA,UAAA,QAAA,EAAA,KAAA,OAAA,UACA,IACA,QAAA,KACA,kIAmBA,YACA,gBACA,oBAEA,GAAA,GACA,EAAA,QAEA,GAAA,IACA,MAAA,KAOA,EAAA,GAAA,6BAEA,QACA,GAAA,cAAA,KAAA,IACA,EAAA,MACA,SAAA,MAAA,EAAA,MAAA,aACA,EAAA,2BAAA,EAAA,MAAA,aACA,EAAA,KAGA,GAAA,GAAA,QAAA,MAMA,GAAA,eA8B8B,GAAK,GAAO,QAAU,EAAQ,YAAc,EAAY,eAI/B,EAAiB,IAAI,UA+BzB,EAAiB,IAAI,WACrB,kBAP9B,2BAYE,wKA3FvB,EACA,GAAA,OAAA,eACA,GAAA,MAAA,WAAA,KAAA,SAAA,UAAA,GAAA,EAAA,SAAA,GAAA,KAAA"}