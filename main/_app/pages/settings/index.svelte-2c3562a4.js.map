{"version":3,"file":"index.svelte-2c3562a4.js","sources":["../../../../../../src/routes/settings/index.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { mutation } from '@urql/svelte';\n  import { UpdateUserDocument } from '$lib/generated';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import { createForm } from 'felte';\n  import { validator } from '@felte/validator-zod';\n  import { svelteReporter, ValidationMessage } from '@felte/reporter-svelte';\n  import { trimNonSchema } from '$lib/utils/forms';\n  import { user } from '$lib/stores/user';\n  import * as zod from 'zod';\n  import type { Form } from '@felte/core';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const updateUser = mutation({\n    query: UpdateUserDocument\n  });\n\n  export const userSchema = zod.object({\n    avatar: zod.optional(zod.any().refine((logo) => 'name' in logo && 'size' in logo && 'type' in logo)),\n    username: zod.string().min(3).max(32)\n  });\n\n  let userForm: Form<{ [key: string]: string }>['form'];\n\n  $: {\n    if ($user) {\n      const { form } = createForm({\n        initialValues: {\n          username: $user.username\n        },\n        extend: [validator, svelteReporter],\n        validateSchema: userSchema,\n        onSubmit: (data) => {\n          updateUser({\n            user: trimNonSchema(data, userSchema),\n            userId: $user.id\n          }).then((value) => {\n            if (value.error) {\n              console.error(value.error.message);\n              errorMessage = 'Error editing guide: ' + value.error.message;\n              errorToast = true;\n            } else {\n              // TODO Toast or something\n              goto(base + '/user/' + value.data.updateUser.id);\n            }\n          });\n        }\n      });\n\n      userForm = form;\n    }\n  }\n\n  $: if (!errorToast) errorMessage = '';\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Change your user settings\" title=\"Settings\" />\n</svelte:head>\n\n<h1 class=\"text-4xl my-4 font-bold\">Settings</h1>\n\n{#if !userForm}\n  <p>Please log in</p>\n{:else}\n  <form use:userForm>\n    <div class=\"grid grid-flow-row gap-6\">\n      <div class=\"grid grid-flow-row gap-2\">\n        <label for=\"avatar\">Avatar:</label>\n        <input\n          id=\"avatar\"\n          class=\"base-input\"\n          name=\"avatar\"\n          type=\"file\"\n          accept=\"image/png,image/jpeg,image/gif\"\n          placeholder=\"Avatar\"\n        />\n        <ValidationMessage for=\"avatar\" let:messages={message}>\n          <span class=\"validation-message\">{message || ''}</span>\n        </ValidationMessage>\n      </div>\n\n      <div class=\"grid grid-flow-row gap-2\">\n        <label for=\"username\">Username:</label>\n        <input id=\"username\" class=\"base-input\" name=\"username\" type=\"text\" placeholder=\"Username\" />\n        <ValidationMessage for=\"username\" let:messages={message}>\n          <span class=\"validation-message\">{message || ''}</span>\n        </ValidationMessage>\n      </div>\n\n      <div>\n        <input type=\"submit\" value=\"Save\" class=\"px-4 py-2 rounded text-base bg-blue-500 cursor-pointer\" />\n      </div>\n    </div>\n  </form>\n{/if}\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["zod.object","zod.optional","zod.any","zod.string","createForm","validator"],"mappings":"w6BAkFsD,wBAAA,iGAQE,wBAAA,0FAjB5B,uFAeE,+OAfF,kOAeE,2yBAlB5B,SACE,OACE,OACE,qBACA,iCAaF,OACE,qBACA,iCAMF,OACE,+VA5BH,sDAAA,sCAAH,mEAe0C,OAAW,wKAA7C,sCAAkC,OAAW,uDAQX,OAAW,wKAA7C,sCAAkC,OAAW,kFAY9C,8CAAA,2BAAP,iCAAO,uLApCH,2GAmCe,2BAAA,mGArCe,wMAAA,+JAApC,0RAqCqB,6PAvFrB,GAAA,GACA,EAAA,QAEA,GAAA,IACA,MAAA,KAGA,EAAAA,IACA,OAAAC,GAAAC,KAAA,OAAA,GAAA,QAAA,IAAA,QAAA,IAAA,QAAA,KACA,SAAAC,KAAA,IAAA,GAAA,IAAA,SAGA,iBA2EqB,4DAxErB,SACA,QAAAC,IACA,eACA,SAAA,EAAA,UAEA,QAAAC,GAAA,IACA,eAAA,EACA,SAAA,IACA,GACA,KAAA,GAAA,EAAA,GACA,OAAA,EAAA,KACA,KAAA,IACA,EAAA,MACA,SAAA,MAAA,EAAA,MAAA,aACA,EAAA,wBAAA,EAAA,MAAA,aACA,EAAA,KAGA,GAAA,GAAA,SAAA,EAAA,KAAA,WAAA,aAMA,EAAA,iBAIA,QAAA,EAAA"}