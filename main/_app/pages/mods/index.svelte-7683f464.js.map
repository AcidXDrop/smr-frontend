{"version":3,"file":"index.svelte-7683f464.js","sources":["../../../../../../src/lib/components/mods/ModGrid.svelte","../../../../../../src/routes/mods/index.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { operationStore, query } from '@urql/svelte';\n  import { GetModsDocument, ModFields, Order } from '$lib/generated';\n  import ModCard from './ModCard.svelte';\n  import PageControls from '$lib/components/utils/PageControls.svelte';\n  import { writable } from 'svelte/store';\n  import { base } from '$app/paths';\n  import Button from '@smui/button';\n  import { Input } from '@smui/textfield';\n  import Paper from '@smui/paper';\n  import Fab from '@smui/fab';\n  import { Icon } from '@smui/common';\n  import { goto } from '$app/navigation';\n  import { page as storePage } from '$app/stores';\n  import { user } from '$lib/stores/user';\n  import FicsitCard from '$lib/components/general/FicsitCard.svelte';\n  import Select, { Option } from '@smui/select';\n\n  export let colCount: 4 | 5 = 4;\n  export let newMod = false;\n  export let showSearch = false;\n\n  let search = $storePage.url.searchParams.get('q');\n\n  // TODO Selectable\n  const perPage = 40;\n  let order: Order = Order.Desc;\n  let orderBy: ModFields = ModFields.LastVersionDate;\n\n  const mods = operationStore(GetModsDocument, { offset: 0, limit: perPage, search, order, orderBy });\n\n  const page = writable(1);\n  let totalMods: number;\n\n  let searchField = search;\n  $: {\n    let changed = false;\n    if ($mods.variables.search !== search) {\n      changed = true;\n      $mods.variables.search = search;\n    }\n\n    if ($mods.variables.order !== order) {\n      changed = true;\n      $mods.variables.order = order;\n    }\n\n    if ($mods.variables.orderBy !== orderBy && orderBy) {\n      changed = true;\n      $mods.variables.orderBy = orderBy;\n    }\n\n    if (changed) {\n      $mods.reexecute();\n    }\n  }\n\n  let timer: number;\n  $: {\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      if (searchField && searchField.length > 2) {\n        if ((search === '' || search === null) && searchField !== '' && searchField !== null) {\n          orderBy = ModFields.Search;\n        }\n\n        search = searchField;\n      } else if (searchField === '' || searchField === null) {\n        if (orderBy === ModFields.Search || !orderBy) {\n          orderBy = ModFields.LastVersionDate;\n        }\n\n        search = null;\n      }\n    }, 250) as unknown as number;\n  }\n\n  page.subscribe((p) => {\n    $mods.variables.offset = (p - 1) * perPage;\n    $mods.reexecute();\n  });\n\n  $: totalMods = $mods?.data?.getMods?.count || 0;\n\n  query(mods);\n\n  $: gridClasses =\n    colCount == 4\n      ? '3xl:grid-cols-4 2xl:grid-cols-3 lg:grid-cols-2 grid-cols-1'\n      : '3xl:grid-cols-3 2xl:grid-cols-2 grid-cols-1';\n\n  function handleKeyDown(event: CustomEvent | KeyboardEvent) {\n    if ((event as KeyboardEvent).key === 'Enter') {\n      goto(base + '/mods?q=' + search);\n    }\n  }\n\n  $: orderFields = [\n    ['Name', 'name'],\n    ['Views', 'views'],\n    ['Downloads', 'downloads'],\n    ['Hotness (Views)', 'hotness'],\n    ['Popularity (Downloads)', 'popularity'],\n    ['Creation Date', 'created_at'],\n    ['Last Version', 'last_version_date'],\n    ...(search !== '' && search !== null ? [['Search', 'search']] : [])\n  ];\n</script>\n\n<div class=\"ml-auto flex flex-wrap justify-between\">\n  {#if newMod && $user !== null}\n    <Button variant=\"outlined\" href=\"{base}/new-mod\" class=\"mb-5\">New Mod</Button>\n  {/if}\n\n  {#if showSearch}\n    <div class=\"search-container flex flex-wrap mb-5 sm:px-4\">\n      <div class=\"mr-3\">\n        <Select bind:value={orderBy} label=\"Order By\">\n          {#each orderFields as orderField}\n            <Option value={orderField[1]}>{orderField[0]}</Option>\n          {/each}\n        </Select>\n      </div>\n      <div class=\"mr-3\">\n        <Select bind:value={order} label=\"Order\">\n          <Option value=\"asc\">Ascending</Option>\n          <Option value=\"desc\">Descending</Option>\n        </Select>\n      </div>\n      <Paper class=\"search-paper mr-3\" elevation={6}>\n        <Icon class=\"material-icons\">search</Icon>\n        <Input bind:value={searchField} on:keypress={handleKeyDown} placeholder=\"Search\" />\n      </Paper>\n      <Fab on:click={() => goto(base + '/mods?q=' + search)} color=\"primary\" mini class=\"solo-fab\" aria-label=\"Search\">\n        <Icon class=\"material-icons\">arrow_forward</Icon>\n      </Fab>\n    </div>\n  {/if}\n\n  <div class=\"mb-5\">\n    <PageControls totalPages={Math.ceil(totalMods / perPage)} currentPage={page} />\n  </div>\n</div>\n\n{#if $mods.fetching}\n  <div class=\"grid {gridClasses} gap-4\">\n    {#each Array(perPage) as _}\n      <FicsitCard fake />\n    {/each}\n  </div>\n{:else if $mods.error}\n  <p>Oh no... {$mods.error.message}</p>\n{:else}\n  <div class=\"grid {gridClasses} gap-4\">\n    {#each $mods.data.getMods.mods as mod}\n      <ModCard {mod} />\n    {/each}\n  </div>\n{/if}\n\n<div class=\"mt-5 ml-auto flex justify-end\">\n  <div>\n    <PageControls totalPages={Math.ceil(totalMods / perPage)} currentPage={page} />\n  </div>\n</div>\n\n<style>\n  .search-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-grow: 1;\n  }\n\n  * :global(.search-paper) {\n    display: flex;\n    align-items: center;\n    flex-grow: 1;\n    max-width: 600px;\n    height: 48px;\n  }\n\n  * :global(.search-paper > *) {\n    display: inline-block;\n    margin: 0 12px;\n  }\n</style>\n","<script lang=\"ts\">\n  import ModGrid from '$lib/components/mods/ModGrid.svelte';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Mods available from the Satisfactory Mod Repository\" title=\"Mods\" />\n</svelte:head>\n\n<ModGrid showSearch={true} newMod={true} colCount={4} />\n"],"names":["page"],"mappings":"wrCA+GsC,uUAA4B,uBAAA,gLAMtC,wBAAA,+IAOA,yBAAA,0GAKsB,8tBAd9C,SACE,0BAOA,mJANsB,wGAOA,sYALe,MAAW,gFAAX,MAAW,oFAA3B,MAAW,qJAAX,MAAW,iKADrB,0BAAL,kQAAK,uBAAL,+HAAA,8DAAA,wJAOkB,yBAAA,kFACC,0BAAA,qpBAIM,sBAAA,oNACV,yBAAA,sEAA0B,yPAA1B,qMAGU,6BAAA,yZAoB1B,KAAM,KAAK,QAAQ,0BAAxB,0QADc,sCAAlB,4EACS,KAAM,KAAK,QAAQ,uBAAxB,uHAAA,2DADc,4EACd,6IAHS,KAAM,MAAM,qCAAtB,0EAAA,uFAAH,4CAAa,KAAM,MAAM,wEALhB,MAAM,wBAAX,mOADc,sCAAlB,4FAAkB,4EACd,wnBApCC,MAAU,QAAU,cAIpB,wCA0BuB,KAAK,KAAK,KAAY,eAAuB,uDAItE,MAAM,WAMD,KAAM,mEAYc,KAAK,KAAK,KAAY,eAAuB,gpBArD3E,qDA8BE,iDAqBF,SACE,kCAnDK,MAAU,QAAU,oGAIpB,iIA0BuB,KAAK,KAAK,KAAY,yLAsBtB,KAAK,KAAK,KAAY,sOAzI5C,GAAU,kFAPL,WAAkB,MAClB,SAAS,OACT,aAAa,MAEpB,EAAS,EAAW,IAAI,aAAa,IAAI,KAIzC,EAAe,GAAM,KACrB,EAAqB,EAAU,qBAE7B,GAAO,GAAe,IAAmB,OAAQ,EAAG,MAAO,EAAS,SAAQ,QAAO,oCAEnFA,GAAO,GAAS,MAClB,GAEA,EAAc,EAuBd,EAoBJA,EAAK,UAAW,QACd,EAAM,UAAU,OAAU,GAAI,GAAK,KACnC,EAAM,cAKR,GAAM,cAOiB,GAChB,EAAwB,MAAQ,SACnC,GAAK,GAAO,WAAa,iBAwBH,+CAOA,yBAOD,uBAEA,GAAK,GAAO,WAAa,oKA1EhD,cAAa,QACb,EAAQ,gBACF,GAAe,EAAY,OAAS,EACjC,MAAW,IAAM,IAAW,OAAS,IAAgB,IAAM,IAAgB,UAC9E,EAAU,EAAU,YAGtB,EAAS,IACA,KAAgB,IAAM,IAAgB,OAC3C,MAAY,EAAU,SAAW,QACnC,EAAU,EAAU,qBAGtB,EAAS,QAEV,yBAtCC,GAAU,GACV,EAAM,UAAU,SAAW,GAC7B,GAAU,OACV,EAAM,UAAU,OAAS,MAGvB,EAAM,UAAU,QAAU,GAC5B,GAAU,OACV,EAAM,UAAU,MAAQ,MAGtB,EAAM,UAAU,UAAY,GAAW,GACzC,GAAU,OACV,EAAM,UAAU,QAAU,MAGxB,GACF,EAAM,+BA6BP,EAAY,GAAO,MAAM,SAAS,OAAS,yBAI3C,EACD,GAAY,EACR,6DACA,iEAQH,IACA,OAAQ,SACR,QAAS,UACT,YAAa,cACb,kBAAmB,YACnB,yBAA0B,eAC1B,gBAAiB,eACjB,eAAgB,wBACb,IAAW,IAAM,IAAW,OAAS,SAAU,gUChGlC,UAAc,YAAgB"}