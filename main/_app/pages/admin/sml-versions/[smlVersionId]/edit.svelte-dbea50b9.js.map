{"version":3,"file":"edit.svelte-dbea50b9.js","sources":["../../../../../../../../src/routes/admin/sml-versions/[smlVersionId]/edit.svelte"],"sourcesContent":["<svelte:head>\n  <MetaDescriptors \n    description=\"Edit SML Version\"\n    title=\"Admin: Edit SML Version\" \n  />\n</svelte:head>\n\n<script lang=\"ts\" context=\"module\">\n  import {paramsToProps} from \"$lib/utils/routing\";\n\n  export const load = paramsToProps();\n</script>\n\n<script lang=\"ts\">\n  import {mutation, operationStore, query} from '@urql/svelte';\n  import {GetSmlVersionAdminDocument, UpdateSmlVersionDocument} from \"$lib/generated\";\n  import Toast from \"$lib/components/general/Toast.svelte\";\n  import {goto} from '$app/navigation';\n  import type {SMLVersionData} from \"$lib/models/sml-versions\";\n  import SMLVersionForm from \"$lib/components/sml-versions/SMLVersionForm.svelte\";\n  import {base} from \"$app/paths\";\n  import MetaDescriptors from \"$lib/components/utils/MetaDescriptors.svelte\";\n\n  export let smlVersionId!: string;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const smlVersion = operationStore(\n    GetSmlVersionAdminDocument,\n    {smlVersionID: smlVersionId}\n  );\n\n  const editSMLVersion = mutation({\n    query: UpdateSmlVersionDocument\n  });\n\n  const onSubmit = (data: SMLVersionData) => {\n    editSMLVersion({\n      smlVersionID: smlVersionId,\n      smlVersion: data\n    }).then(value => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error editing sMLVersion: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        goto(base + '/admin/sml-versions');\n      }\n    });\n  }\n\n  $: if (!errorToast) errorMessage = '';\n\n  $: initialValues = $smlVersion.data ? {\n    ...$smlVersion.data.getSMLVersion,\n    logo: undefined\n  } : undefined;\n\n  query(smlVersion);\n</script>\n\n<h1 class=\"text-4xl my-4 font-bold\">Edit SMLVersion</h1>\n\n{#if $smlVersion.fetching}\n  <p>Loading...</p>\n{:else if $smlVersion.error}\n  <p>Oh no... {$smlVersion.error.message}</p>\n{:else}\n  <SMLVersionForm onSubmit={onSubmit} initialValues={initialValues} submitText=\"Save\"/>\n{/if}\n\n<Toast bind:running={errorToast}>\n  <span>{errorMessage}</span>\n</Toast>\n"],"names":["ctx","ctx2","error","message","fetching","load","paramsToProps","smlVersionId","errorMessage","errorToast","smlVersion","operationStore","GetSmlVersionAdminDocument","smlVersionID","editSMLVersion","mutation","query","UpdateSmlVersionDocument","initialValues","$smlVersion","data","Object","assign","getSMLVersion","logo","then","value","base"],"mappings":"86BAsE4BA,mBAAyBA,wIAAAC,0HAFtCD,KAAYE,MAAMC,mCAA5B,yDAAA,sFAAUF,KAAYC,MAAMC,0FAF5B,mDAAA,gIAQIH,8CAAAA,4DAAAC,4LATJA,KAAYG,WAEPH,KAAYC,oHAMDF,iBAAAA,kGAVe,6MAAA,gcAUfC,mNA/DNI,EAAOC,4CAaTC,KAEPC,EAAe,GACfC,GAAa,QAEXC,EAAaC,EACjBC,GACCC,aAAcN,+BAGXO,EAAiBC,GACrBC,MAAOC,aA0BHP,0FAPED,OAAYD,EAAe,uBAEhCU,EAAgBC,EAAYC,KAAMC,OAAAC,OAAAD,OAAAC,UAChCH,EAAYC,KAAKG,gBACpBC,UAAM,SACJ,sBAnBAX,aAAcN,EACdG,WAAYU,IACXK,UACGC,EAAMxB,eACAA,MAAMwB,EAAMxB,MAAMC,aAC1BK,EAAe,6BAA+BkB,EAAMxB,MAAMC,aAC1DM,GAAa,MAGRkB,EAAO"}