{"version":3,"file":"index.svelte-136692c0.js","sources":["../../../../../../../../../src/lib/components/versions/VersionDescription.svelte","../../../../../../../../../src/lib/components/versions/VersionInfo.svelte","../../../../../../../../../src/routes/mod/[modId]/version/[versionId]/index.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { markdown } from '$lib/utils/markdown';\n\n  export let changelog!: string;\n</script>\n\n<div class=\"markdown-content\">\n  {#await markdown(changelog) then changelogRendered}\n    <p>{@html changelogRendered}</p>\n  {/await}\n</div>\n","<script lang=\"ts\">\n  import type { Version } from '$lib/generated';\n\n  export let version!: Pick<Version, 'created_at' | 'sml_version' | 'size' | 'stability' | 'downloads' | 'hash'>;\n</script>\n\n<div class=\"text-lg\">\n  <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n  <!-- TODO Nice Date -->\n  <span><strong>Created:</strong> {version.created_at}</span><br />\n  <span><strong>Downloads:</strong> {version.downloads}</span><br />\n  <span><strong>SML Version:</strong> {version.sml_version}</span><br />\n  <span><strong>Stability:</strong> {version.stability}</span><br />\n  <!-- TODO Pretty Bytes -->\n  <span><strong>Size:</strong> {version.size}</span><br />\n  <span><strong>Hash:</strong> {version.hash}</span>\n</div>\n","<script lang=\"ts\" context=\"module\">\n  import { paramsToProps } from '$lib/utils/routing';\n  import { operationStore } from '@urql/svelte';\n  import { GetModVersionDocument } from '$lib/generated';\n  import { loadWaitForNoFetch } from '$lib/utils/gql';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n\n  const versionQ = operationStore(GetModVersionDocument, { version: undefined });\n\n  export const load = paramsToProps(async (input) => {\n    versionQ.variables.version = input.page.params.versionId;\n    return loadWaitForNoFetch({\n      version: versionQ\n    })(input);\n  });\n</script>\n\n<script lang=\"ts\">\n  import { mutation, query } from '@urql/svelte';\n  import { DeleteVersionDocument } from '$lib/generated';\n  import VersionDescription from '$lib/components/versions/VersionDescription.svelte';\n  import VersionInfo from '$lib/components/versions/VersionInfo.svelte';\n  import Icon from '@iconify/svelte';\n  import downloadIcon from '@iconify/icons-mdi/download.js';\n  import { API_REST } from '$lib/core';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import Dialog from '$lib/components/general/Dialog.svelte';\n  import { writable } from 'svelte/store';\n  import { goto } from '$app/navigation';\n  import { user } from '$lib/stores/user';\n  import { base } from '$app/paths';\n  import { browser } from '$app/env';\n\n  export let modId!: string;\n  export let versionId!: string;\n  export let version: typeof versionQ;\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  const deleteVersion = mutation({\n    query: DeleteVersionDocument\n  });\n\n  $: canUserEdit =\n    $user?.roles?.deleteContent ||\n    $version?.data?.getVersion.mod?.authors?.findIndex((author) => author.user_id == $user?.id) >= 0;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteVersionFn = () => {\n    deleteVersion({ versionId }).then((value) => {\n      if (value.error) {\n        console.error(value.error.message);\n        errorMessage = 'Error deleting version: ' + value.error.message;\n        errorToast = true;\n      } else {\n        // TODO Toast or something\n        goto(base + '/mod/' + modId);\n      }\n    });\n  };\n\n  if (browser) {\n    query(version);\n  }\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Information for mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" />\n  {/if}\n</svelte:head>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else if $version.data.getVersion}\n  <div class=\"grid gap-8 grid-auto-max\">\n    <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n      <div class=\"grid grid-flow-col grid-auto-max h-auto items-center\">\n        <h1 class=\"text-4xl my-4 font-bold\">\n          {$version.data.getVersion.mod.name}\n          Version {$version.data.getVersion.version}\n        </h1>\n\n        <div class=\"grid grid-flow-col gap-4\">\n          {#if canUserEdit}\n            <button\n              class=\"py-2 px-4 rounded text-base bg-yellow-600\"\n              on:click={() => goto(base + '/mod/' + modId + '/version/' + versionId + '/edit')}>\n              Edit\n            </button>\n            <button class=\"py-2 px-4 rounded text-base bg-red-500\" on:click={() => deleteDialogOpen.set(true)}>\n              Delete\n            </button>\n          {/if}\n\n          <a\n            href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/download'}\n            class=\"py-2 px-4 rounded text-base bg-green-600 text-center\">Download</a>\n          <!-- TODO SMM -->\n          <a href={base} class=\"py-2 px-4 rounded text-base bg-blue-600 text-center\">\n            <span>Install</span>\n            <Icon icon={downloadIcon} inline={true} class=\"inline-block\" />\n          </a>\n        </div>\n      </div>\n      <VersionDescription changelog={$version.data.getVersion.changelog} />\n    </div>\n    <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n      <VersionInfo version={$version.data.getVersion} />\n    </div>\n  </div>\n\n  <Dialog bind:open={$deleteDialogOpen}>\n    <div class=\"grid grid-flow-row gap-4\">\n      <h3 class=\"text-2xl font-bold\">Delete Version?</h3>\n\n      <span>Are you sure you wish to delete this version</span>\n\n      <button class=\"py-1 px-4 rounded text-base bg-yellow-600\" on:click={() => deleteDialogOpen.set(false)}>\n        Cancel\n      </button>\n      <button class=\"py-1 px-4 rounded text-base bg-red-500\" on:click={() => deleteVersionFn()}> Delete </button>\n    </div>\n  </Dialog>\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n\n<style lang=\"postcss\">\n  .grid-auto-max {\n    grid-template-columns: auto max-content;\n  }\n</style>\n"],"names":["ctx","ctx2","markdown","changelog","created_at","downloads","sml_version","stability","size","hash","version","data","getVersion","mod","name","downloadIcon","API_REST","base","error","message","fetching","__awaiter","thisArg","_arguments","P","generator","versionQ","operationStore","GetModVersionDocument","load","paramsToProps","variables","input","page","params","versionId","loadWaitForNoFetch","_a","_b","_c","_d","modId","errorMessage","errorToast","deleteVersion","mutation","query","DeleteVersionDocument","deleteDialogOpen","writable","deleteVersionFn","then","value","canUserEdit","$user","roles","deleteContent","$version","authors","findIndex","author","user_id","id","goto","set"],"mappings":"wqCAQcA,mHAAAC,wMADJC,EAASF,yQAATE,EAASF,kHAJNG,8PCMsBH,KAAQI,iBACNJ,KAAQK,gBACNL,KAAQM,kBACVN,KAAQO,gBAEbP,KAAQQ,WACRR,KAAQS,4CARF,4CAEtB,wEACA,0EACA,4EACA,0EAEA,uEACA,mHARsB,4FAEtB,6IACA,+IACA,qJACA,uJAEA,qJACA,8eANmBR,KAAQG,sCACNH,KAAQI,qCACNJ,KAAQK,uCACVL,KAAQM,qCAEbN,KAAQO,gCACRP,KAAQQ,0EAZ3BC,+NCoEmCV,KAASW,KAAKC,WAAWC,IAAIC,SAAOd,KAASW,KAAKC,WAAWF,6BACnFV,KAASW,KAAKC,WAAWC,IAAIC,SAAOd,KAASW,KAAKC,WAAWF,sJADvCT,KAASU,KAAKC,WAAWC,IAAIC,SAAOb,KAASU,KAAKC,WAAWF,sCACnFT,KAASU,KAAKC,WAAWC,IAAIC,SAAOb,KAASU,KAAKC,WAAWF,uIA+D9D,mBAAA,6IAlDdV,KAASW,KAAKC,WAAWC,IAAIC,WACrBd,KAASW,KAAKC,WAAWF,cAI7BV,yDAiBSe,UAAsB,qDAITf,KAASW,KAAKC,WAAWT,sCAGlCH,KAASW,KAAKC,+FAIrBZ,eAAAA,uHAaEA,kBAAAA,wHA9CqB,+EAkB6B,2CAGvD,qTArB0B,2JAkB6B,2GAGvD,+UAJAgB,EAAW,QAAUhB,KAAQ,aAAeA,KAAY,4FAGvDiB,onBApBRhB,KAASU,KAAKC,WAAWC,IAAIC,uCACrBb,KAASU,KAAKC,WAAWF,qBAI7BT,sFAYGe,EAAW,QAAUf,KAAQ,aAAeA,KAAY,0DASrCA,KAASU,KAAKC,WAAWT,gDAGlCF,KAASU,KAAKC,kGAIrBX,6GAaEA,mWApDRD,KAASkB,MAAMC,mCAAzB,yDAAA,sFAAUlB,KAASiB,MAAMC,2FAFzB,mDAAA,6IAgB0F,gCAGe,qEAHf,wEAGe,0XAwBzE,yCAEzB,wEAEgG,kCAGZ,oGAP3D,yEAEzB,gHAEgG,0EAGZ,6cAKrFnB,8CAAAA,6DAAAC,wDA/DHD,KAASoB,WAAapB,KAASkB,OAASlB,KAASW,KAAKC,oEAOzDX,KAASmB,WAEJnB,KAASiB,QAETjB,KAASU,KAAKC,qSAXhBX,KAASmB,UAAanB,KAASiB,QAASjB,KAASU,KAAKC,qWArE5BS,YAAAC,EAAAC,EAAAC,EAAAC,2RAO1BC,GAAWC,EAAeC,GAAyBlB,aAAS,IAErDmB,GAAOC,MAA8BT,+CACvCU,UAAUrB,QAAUsB,EAAMC,KAAKC,OAAOC,UACxCC,GACL1B,QAASgB,IADJU,CAEJJ,kFAIUK,EAAAC,EAAAC,EAAAC,kEAgBJC,gBACAN,cACAzB,aAEPgC,EAAe,GACfC,GAAa,QAEXC,EAAgBC,GACpBC,MAAOC,IAOHC,EAAmBC,GAAkB,8BAErCC,UACYf,UAAAA,IAAagB,UACvBC,EAAMlC,eACAA,MAAMkC,EAAMlC,MAAMC,aAC1BuB,EAAe,2BAA6BU,EAAMlC,MAAMC,aACxDwB,GAAa,MAGR1B,EAAO,QAAUwB,SAMpB/B,iKApBL2C,GACW,YAAZhB,EAAAiB,MAAAA,SAAAA,EAAOC,iBAAKlB,SAAAA,EAAEmB,iBACyB,YAAvChB,EAA8B,YAA9BD,EAAc,YAAdD,EAAAmB,MAAAA,SAAAA,EAAU9C,gBAAI2B,SAAAA,EAAE1B,WAAWC,eAAG0B,SAAAA,EAAEmB,mBAAOlB,SAAAA,EAAEmB,cAAsBC,EAAOC,yBAAWP,EAAOQ,QAAO,uCA+CrEC,EAAK9C,EAAO,QAAUwB,EAAQ,YAAcN,EAAY,aAGHa,EAAiBgB,KAAI,OA4BxBhB,EAAiBgB,KAAI,OAGxBd"}